// taken from the c code from the fudan code sample
pub fn crc8(data: &[u8]) -> u8 {
    let mut crc8_res: u32 = 0xFF;
    for item in data {
        crc8_res ^= *item as u32;
        for j in 0..8 {
            if (crc8_res & 0x01) == 0x01 {
                crc8_res = (crc8_res >> 1) ^ 0xb8;
            } else {
                crc8_res >>= 1;
            }
            crc8_res &= 0xFF;
        }
    }
    crc8_res as u8
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_vectors() {
        // Generated by the original c code for reference
        let test_vectors = &[
            ([0x00].as_slice(), 0x23),
            (&[0xFF], 0x00),
            (&[0x01, 0x02, 0x03, 0x04, 0x05], 0x34),
            (&[0xDE, 0xAD, 0xBE, 0xEF], 0x64),
            (&[0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], 0x68),
            (&[0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF], 0x7C),
            (&[0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0], 0xDA),
            (&[0x01], 0x47),
            (&[0x02], 0xEB),
            (&[0x03], 0x8F),
            (&[0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF], 0xFA),
            (
                &[0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09],
                0xD0,
            ),
            (
                &[
                    0x1d, 0xc5, 0x23, 0x73, 0xf2, 0x13, 0x00, 0x10, 0xf1, 0x44, 0x00, 0x04, 0x20,
                ],
                0xBB,
            ),
        ];

        for (data, res) in test_vectors {
            let crc8 = crc8(data);
            assert_eq!(*res, crc8, "Expected {res:02x}, got {crc8:02x}");
        }
    }
}
